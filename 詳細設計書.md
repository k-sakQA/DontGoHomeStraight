# iPhoneã‚¢ãƒ—ãƒªè©³ç´°è¨­è¨ˆæ›¸
**ã‚¢ãƒ—ãƒªåï¼šã¾ã£ã™ãå¸°ã‚ŠãŸããªã„**

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   iOS Client    â”‚â—„â”€â”€â–ºâ”‚  OpenAI API     â”‚    â”‚ Google Maps API â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ - SwiftUI View  â”‚    â”‚ - ChatGPT API   â”‚    â”‚ - Places API    â”‚
â”‚ - Core Location â”‚    â”‚ - çµŒç”±åœ°ææ¡ˆ    â”‚    â”‚ - Directions    â”‚
â”‚ - MapKit        â”‚    â”‚                 â”‚    â”‚ - Geocoding     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: SwiftUI, UIKit (iOS 15.0+)
- **åœ°å›³ãƒ»ä½ç½®æƒ…å ±**: Core Location, MapKit, Google Maps SDK
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: URLSession, Combine
- **AIé€£æº**: OpenAI API (GPT-4)
- **å¤–éƒ¨API**: Google Places API, Google Directions API
- **ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: XCTest (TDD)
- **è¨­å®šç®¡ç†**: .env, Bundle Configuration

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆï¼ˆClean Architectureï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  View   â”‚  â”‚ ViewModel   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Domain Layer           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Entity  â”‚  â”‚  UseCase    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Data Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Repositoryâ”‚ â”‚DataSource   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
DontGoHomeStraight/
â”œâ”€â”€ App/
â”‚   â”œâ”€â”€ DontGoHomeStraightApp.swift
â”‚   â””â”€â”€ Config/
â”‚       â”œâ”€â”€ Environment.swift
â”‚       â””â”€â”€ APIKeys.swift
â”œâ”€â”€ Presentation/
â”‚   â”œâ”€â”€ Views/
â”‚   â”‚   â”œâ”€â”€ HomeView.swift
â”‚   â”‚   â”œâ”€â”€ DestinationSettingView.swift
â”‚   â”‚   â”œâ”€â”€ TransportModeView.swift
â”‚   â”‚   â”œâ”€â”€ MoodSelectionView.swift
â”‚   â”‚   â”œâ”€â”€ GenreSelectionView.swift
â”‚   â”‚   â”œâ”€â”€ NavigationView.swift
â”‚   â”‚   â””â”€â”€ ArrivalView.swift
â”‚   â”œâ”€â”€ ViewModels/
â”‚   â”‚   â”œâ”€â”€ HomeViewModel.swift
â”‚   â”‚   â”œâ”€â”€ DestinationViewModel.swift
â”‚   â”‚   â”œâ”€â”€ MoodSelectionViewModel.swift
â”‚   â”‚   â”œâ”€â”€ GenreSelectionViewModel.swift
â”‚   â”‚   â””â”€â”€ NavigationViewModel.swift
â”‚   â””â”€â”€ Components/
â”‚       â”œâ”€â”€ MoodButtonGroup.swift
â”‚       â”œâ”€â”€ TransportModeSelector.swift
â”‚       â””â”€â”€ CustomMapView.swift
â”œâ”€â”€ Domain/
â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â”œâ”€â”€ Destination.swift
â”‚   â”‚   â”œâ”€â”€ TransportMode.swift
â”‚   â”‚   â”œâ”€â”€ Mood.swift
â”‚   â”‚   â”œâ”€â”€ Place.swift
â”‚   â”‚   â”œâ”€â”€ Genre.swift
â”‚   â”‚   â””â”€â”€ NavigationRoute.swift
â”‚   â”œâ”€â”€ UseCases/
â”‚   â”‚   â”œâ”€â”€ DestinationUseCase.swift
â”‚   â”‚   â”œâ”€â”€ MoodSelectionUseCase.swift
â”‚   â”‚   â”œâ”€â”€ PlaceRecommendationUseCase.swift
â”‚   â”‚   â”œâ”€â”€ GenreSelectionUseCase.swift
â”‚   â”‚   â””â”€â”€ NavigationUseCase.swift
â”‚   â””â”€â”€ Repositories/
â”‚       â”œâ”€â”€ LocationRepository.swift
â”‚       â”œâ”€â”€ PlaceRepository.swift
â”‚       â”œâ”€â”€ AIRecommendationRepository.swift
â”‚       â””â”€â”€ CacheRepository.swift
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ Repositories/
â”‚   â”‚   â”œâ”€â”€ LocationRepositoryImpl.swift
â”‚   â”‚   â”œâ”€â”€ PlaceRepositoryImpl.swift
â”‚   â”‚   â”œâ”€â”€ AIRecommendationRepositoryImpl.swift
â”‚   â”‚   â””â”€â”€ CacheRepositoryImpl.swift
â”‚   â”œâ”€â”€ DataSources/
â”‚   â”‚   â”œâ”€â”€ Local/
â”‚   â”‚   â”‚   â”œâ”€â”€ UserDefaultsDataSource.swift
â”‚   â”‚   â”‚   â””â”€â”€ CoreDataStack.swift
â”‚   â”‚   â””â”€â”€ Remote/
â”‚   â”‚       â”œâ”€â”€ OpenAIAPIClient.swift
â”‚   â”‚       â”œâ”€â”€ GooglePlacesAPIClient.swift
â”‚   â”‚       â””â”€â”€ GoogleMapsAPIClient.swift
â”‚   â””â”€â”€ Models/
â”‚       â”œâ”€â”€ OpenAIRequest.swift
â”‚       â”œâ”€â”€ OpenAIResponse.swift
â”‚       â”œâ”€â”€ GooglePlacesResponse.swift
â”‚       â””â”€â”€ CachedPlace.swift
â”œâ”€â”€ Utils/
â”‚   â”œâ”€â”€ Extensions/
â”‚   â”‚   â”œâ”€â”€ CLLocation+Extension.swift
â”‚   â”‚   â””â”€â”€ String+Extension.swift
â”‚   â”œâ”€â”€ Managers/
â”‚   â”‚   â”œâ”€â”€ LocationManager.swift
â”‚   â”‚   â””â”€â”€ NetworkManager.swift
â”‚   â””â”€â”€ Constants/
â”‚       â”œâ”€â”€ AppConstants.swift
â”‚       â””â”€â”€ APIConstants.swift
â””â”€â”€ Tests/
    â”œâ”€â”€ DomainTests/
    â”œâ”€â”€ DataTests/
    â”œâ”€â”€ PresentationTests/
    â””â”€â”€ TestHelpers/
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆ

### 3.1 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©

#### 3.1.1 Destinationï¼ˆç›®çš„åœ°ï¼‰

```swift
struct Destination {
    let id: UUID
    let name: String
    let coordinate: CLLocationCoordinate2D
    let address: String
    let createdAt: Date
}
```

#### 3.1.2 TransportModeï¼ˆç§»å‹•æ‰‹æ®µï¼‰

```swift
enum TransportMode: String, CaseIterable {
    case walking = "walking"
    case driving = "driving"
    case transit = "transit"
    case cycling = "cycling"
    
    var displayName: String {
        switch self {
        case .walking: return "å¾’æ­©"
        case .driving: return "è»Š"
        case .transit: return "å…¬å…±äº¤é€šæ©Ÿé–¢"
        case .cycling: return "è‡ªè»¢è»Š"
        }
    }
    
    var icon: String {
        switch self {
        case .walking: return "figure.walk"
        case .driving: return "car"
        case .transit: return "tram"
        case .cycling: return "bicycle"
        }
    }
}
```

#### 3.1.3 Moodï¼ˆæ°—åˆ†ï¼‰

```swift
struct Mood {
    let activityType: ActivityType
    let vibeType: VibeType
}

enum ActivityType: String, CaseIterable {
    case indoor = "indoor"
    case outdoor = "outdoor"
    
    var displayName: String {
        switch self {
        case .indoor: return "ã‚¤ãƒ³ãƒ‰ã‚¢"
        case .outdoor: return "ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢"
        }
    }
}

enum VibeType: String, CaseIterable {
    case jazzy = "jazzy"
    case discovery = "discovery"
    case exciting = "exciting"
    
    var displayName: String {
        switch self {
        case .jazzy: return "Jazzy"
        case .discovery: return "ç™ºè¦‹ï¼"
        case .exciting: return "ãƒ¯ã‚¯ãƒ¯ã‚¯"
        }
    }
}
```

#### 3.1.4 Placeï¼ˆå ´æ‰€ï¼‰

```swift
struct Place {
    let id: String
    let name: String
    let coordinate: CLLocationCoordinate2D
    let address: String
    let genre: Genre
    let rating: Double?
    let priceLevel: Int?
    let photoReference: String?
    let isOpen: Bool?
    let placeId: String
}
```

#### 3.1.5 Genreï¼ˆã‚¸ãƒ£ãƒ³ãƒ«ï¼‰

```swift
struct Genre {
    let id: String
    let name: String
    let category: GenreCategory
    let googleMapType: String
}

enum GenreCategory: String {
    case restaurant = "restaurant"
    case other = "other"
    
    // 30% : 70% ã®æ¯”ç‡
    static func getRandomCategory() -> GenreCategory {
        return Int.random(in: 1...10) <= 3 ? .restaurant : .other
    }
}
```

#### 3.1.6 NavigationRouteï¼ˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµŒè·¯ï¼‰

```swift
struct NavigationRoute {
    let id: UUID
    let origin: CLLocationCoordinate2D
    let destination: CLLocationCoordinate2D
    let waypoint: Place
    let transportMode: TransportMode
    let totalDistance: CLLocationDistance
    let estimatedDuration: TimeInterval
    let polyline: String
    let createdAt: Date
}
```

### 3.2 APIé€šä¿¡ãƒ¢ãƒ‡ãƒ«

#### 3.2.1 OpenAI API Request

```swift
struct OpenAIRecommendationRequest {
    let currentLocation: CLLocationCoordinate2D
    let destination: CLLocationCoordinate2D
    let currentTime: Date
    let mood: Mood
    let transportMode: TransportMode
    let excludedPlaceIds: [String]
    
    func toPrompt() -> String {
        return """
        ç¾åœ¨åœ°: \(currentLocation.latitude), \(currentLocation.longitude)
        ç›®çš„åœ°: \(destination.latitude), \(destination.longitude)
        ç¾åœ¨æ™‚åˆ»: \(DateFormatter.apiFormatter.string(from: currentTime))
        æ°—åˆ†: \(mood.activityType.displayName) + \(mood.vibeType.displayName)
        ç§»å‹•æ‰‹æ®µ: \(transportMode.displayName)
        é™¤å¤–ã‚¹ãƒãƒƒãƒˆ: \(excludedPlaceIds.joined(separator: ", "))
        
        ä¸Šè¨˜ã®æ¡ä»¶ã§ã€çµŒç”±åœ°ã¨ã—ã¦æœ€é©ãª3ã¤ã®ã‚¹ãƒãƒƒãƒˆã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
        é£²é£Ÿåº—ã‚’30%ã€ãã‚Œä»¥å¤–ã‚’70%ã®å‰²åˆã§å«ã‚ã¦ãã ã•ã„ã€‚
        å„ã‚¹ãƒãƒƒãƒˆã«ã¤ã„ã¦ã€GooglePlaces APIã§æ¤œç´¢å¯èƒ½ãªå…·ä½“çš„ãªåº—åã¾ãŸã¯æ–½è¨­åã‚’å›ç­”ã—ã¦ãã ã•ã„ã€‚
        """
    }
}
```

#### 3.2.2 Google Places API Response

```swift
struct GooglePlacesResponse: Codable {
    let results: [PlaceResult]
    let status: String
    let nextPageToken: String?
}

struct PlaceResult: Codable {
    let placeId: String
    let name: String
    let geometry: PlaceGeometry
    let vicinity: String
    let types: [String]
    let rating: Double?
    let priceLevel: Int?
    let photos: [PlacePhoto]?
    let openingHours: OpeningHours?
    
    private enum CodingKeys: String, CodingKey {
        case placeId = "place_id"
        case name, geometry, vicinity, types, rating
        case priceLevel = "price_level"
        case photos
        case openingHours = "opening_hours"
    }
}
```

---

## 4. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 PlaceRecommendationUseCase

```swift
protocol PlaceRecommendationUseCase {
    func getRecommendations(
        currentLocation: CLLocationCoordinate2D,
        destination: CLLocationCoordinate2D,
        mood: Mood,
        transportMode: TransportMode
    ) async throws -> [Genre]
}

class PlaceRecommendationUseCaseImpl: PlaceRecommendationUseCase {
    private let aiRepository: AIRecommendationRepository
    private let placeRepository: PlaceRepository
    private let cacheRepository: CacheRepository
    
    func getRecommendations(
        currentLocation: CLLocationCoordinate2D,
        destination: CLLocationCoordinate2D,
        mood: Mood,
        transportMode: TransportMode
    ) async throws -> [Genre] {
        // 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰é™¤å¤–ãƒªã‚¹ãƒˆã‚’å–å¾—
        let excludedPlaceIds = await cacheRepository.getExcludedPlaceIds()
        
        // 2. OpenAI APIã§æ¨è–¦ã‚’å–å¾—
        let aiRecommendations = try await aiRepository.getRecommendations(
            request: OpenAIRecommendationRequest(
                currentLocation: currentLocation,
                destination: destination,
                currentTime: Date(),
                mood: mood,
                transportMode: transportMode,
                excludedPlaceIds: excludedPlaceIds
            )
        )
        
        // 3. Google Places APIã§å®Ÿåœ¨æ€§ã‚’ç¢ºèª
        var validPlaces: [Place] = []
        for recommendation in aiRecommendations {
            if let place = try await placeRepository.searchPlace(name: recommendation) {
                validPlaces.append(place)
            }
        }
        
        // 4. 3ä»¶ã«æº€ãŸãªã„å ´åˆã¯è¿½åŠ æ¤œç´¢
        if validPlaces.count < 3 {
            let additionalPlaces = try await searchAdditionalPlaces(
                location: currentLocation,
                mood: mood,
                needed: 3 - validPlaces.count,
                excludeIds: validPlaces.map { $0.id }
            )
            validPlaces.append(contentsOf: additionalPlaces)
        }
        
        // 5. å€™è£œãªã—ã®å ´åˆ
        if validPlaces.isEmpty {
            throw PlaceRecommendationError.noValidPlaces
        }
        
        // 6. ã‚¸ãƒ£ãƒ³ãƒ«æƒ…å ±ã®ã¿è¿”å´ï¼ˆã‚¹ãƒãƒƒãƒˆåã¯éš åŒ¿ï¼‰
        let genres = validPlaces.map { place in
            Genre(
                id: UUID().uuidString,
                name: place.genre.name,
                category: place.genre.category,
                googleMapType: place.genre.googleMapType
            )
        }
        
        // 7. ææ¡ˆã—ãŸã‚¹ãƒãƒƒãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
        await cacheRepository.savePlacesForGenres(places: validPlaces, genres: genres)
        
        return Array(genres.prefix(3))
    }
}
```

### 4.2 NavigationUseCase

```swift
protocol NavigationUseCase {
    func startNavigation(
        origin: CLLocationCoordinate2D,
        destination: CLLocationCoordinate2D,
        selectedGenre: Genre,
        transportMode: TransportMode
    ) async throws -> NavigationRoute
    
    func checkArrival(
        currentLocation: CLLocationCoordinate2D,
        waypoint: Place
    ) -> Bool
}

class NavigationUseCaseImpl: NavigationUseCase {
    private let cacheRepository: CacheRepository
    private let locationRepository: LocationRepository
    
    func startNavigation(
        origin: CLLocationCoordinate2D,
        destination: CLLocationCoordinate2D,
        selectedGenre: Genre,
        transportMode: TransportMode
    ) async throws -> NavigationRoute {
        // 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰é¸æŠã•ã‚ŒãŸã‚¸ãƒ£ãƒ³ãƒ«ã«å¯¾å¿œã™ã‚‹ã‚¹ãƒãƒƒãƒˆã‚’å–å¾—
        guard let waypoint = await cacheRepository.getPlaceForGenre(genre: selectedGenre) else {
            throw NavigationError.waypointNotFound
        }
        
        // 2. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµŒè·¯ã‚’ä½œæˆ
        let route = NavigationRoute(
            id: UUID(),
            origin: origin,
            destination: destination,
            waypoint: waypoint,
            transportMode: transportMode,
            totalDistance: 0, // Google Directions APIã§å–å¾—
            estimatedDuration: 0, // Google Directions APIã§å–å¾—
            polyline: "", // Google Directions APIã§å–å¾—
            createdAt: Date()
        )
        
        // 3. Google Maps ã‚¢ãƒ—ãƒªã§çµŒè·¯æ¡ˆå†…é–‹å§‹
        try await locationRepository.startGoogleMapsNavigation(route: route)
        
        return route
    }
    
    func checkArrival(
        currentLocation: CLLocationCoordinate2D,
        waypoint: Place
    ) -> Bool {
        let distance = CLLocation(
            latitude: currentLocation.latitude,
            longitude: currentLocation.longitude
        ).distance(from: CLLocation(
            latitude: waypoint.coordinate.latitude,
            longitude: waypoint.coordinate.longitude
        ))
        
        // åŠå¾„50mä»¥å†…ã§åˆ°ç€ã¨ã¿ãªã™
        return distance <= 50.0
    }
}
```

---

## 5. UI/UXè¨­è¨ˆ

### 5.1 ç”»é¢é·ç§»å›³

```
èµ·å‹•
  â†“
ãƒ›ãƒ¼ãƒ ç”»é¢ â”€â”€â†’ ç›®çš„åœ°è¨­å®šç”»é¢
  â†“                â†“
ç§»å‹•æ‰‹æ®µé¸æŠ â†â”€â”€â”€â”€â”€â”€â”˜
  â†“
æ°—åˆ†é¸æŠç”»é¢
  â†“
ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠç”»é¢
  â†“
ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
  â†“
åˆ°ç€æ¤œçŸ¥ãƒ»ã‚¹ãƒãƒƒãƒˆåè¡¨ç¤º
```

### 5.2 å„ç”»é¢ã®è©³ç´°è¨­è¨ˆ

#### 5.2.1 ãƒ›ãƒ¼ãƒ ç”»é¢ï¼ˆHomeViewï¼‰

**ç›®çš„**: ã‚¢ãƒ—ãƒªã®é–‹å§‹ç‚¹ã¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ãƒ—ãƒªã®ç›®çš„ã‚’ä¼ãˆã‚‹

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ã¾ã£ã™ãå¸°ã‚ŠãŸããªã„    â”‚
â”‚                         â”‚
â”‚    ğŸ—ºï¸ ä»Šæ—¥ã¯ã©ã“ã¸ï¼Ÿ     â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ç›®çš„åœ°ã‚’è¨­å®šã™ã‚‹  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚    ç¾åœ¨åœ°: æ±äº¬é§…         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ«
- ãƒ¡ã‚¤ãƒ³ç”»åƒ/ã‚¢ã‚¤ã‚³ãƒ³
- ã€Œç›®çš„åœ°ã‚’è¨­å®šã™ã‚‹ã€ãƒœã‚¿ãƒ³
- ç¾åœ¨åœ°è¡¨ç¤º

#### 5.2.2 ç›®çš„åœ°è¨­å®šç”»é¢ï¼ˆDestinationSettingViewï¼‰

**ç›®çš„**: ç›®çš„åœ°ã‚’åœ°å›³ã¾ãŸã¯ãƒ†ã‚­ã‚¹ãƒˆã§è¨­å®š

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç›®çš„åœ°ã‚’è¨­å®š        â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 â”‚    â”‚
â”‚  â”‚    MapView      â”‚    â”‚
â”‚  â”‚                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ” ç›®çš„åœ°ã‚’æ¤œç´¢   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     æ¬¡ã¸        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ©Ÿèƒ½**:
- åœ°å›³ã‚¿ãƒƒãƒ—ã§ç›®çš„åœ°è¨­å®š
- æ¤œç´¢ãƒãƒ¼ã§ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
- ç›®çš„åœ°ç¢ºå®šå¾Œã€æ¬¡ã®ç”»é¢ã¸é·ç§»

#### 5.2.3 ç§»å‹•æ‰‹æ®µé¸æŠç”»é¢ï¼ˆTransportModeViewï¼‰

**ç›®çš„**: ç§»å‹•æ‰‹æ®µã‚’é¸æŠ

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç§»å‹•æ‰‹æ®µã‚’é¸æŠ       â”‚
â”‚                         â”‚
â”‚  ğŸš¶â€â™‚ï¸ å¾’æ­©   ğŸš— è»Š        â”‚
â”‚                         â”‚
â”‚  ğŸš‡ é›»è»Š   ğŸš´â€â™‚ï¸ è‡ªè»¢è»Š    â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     æ¬¡ã¸        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.2.4 æ°—åˆ†é¸æŠç”»é¢ï¼ˆMoodSelectionViewï¼‰

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ã®æ°—åˆ†ã‚’é¸æŠï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã®æ’ä»–åˆ¶å¾¡ï¼‰

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ä»Šã®æ°—åˆ†ã¯ï¼Ÿ         â”‚
â”‚                         â”‚
â”‚  ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚¿ã‚¤ãƒ—      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ã‚¤ãƒ³ãƒ‰ã‚¢â”‚  â”‚ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                         â”‚
â”‚  ãƒã‚¤ãƒ–ã‚¿ã‚¤ãƒ—            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Jazzyâ”‚â”‚ç™ºè¦‹ï¼â”‚â”‚ãƒ¯ã‚¯ãƒ¯ã‚¯â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     æ¬¡ã¸        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ¶ç´„**:
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã¯æ’ä»–é¸æŠï¼ˆã‚¤ãƒ³ãƒ‰ã‚¢ OR ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ï¼‰
- ãƒã‚¤ãƒ–ã‚¿ã‚¤ãƒ—ã‚‚æ’ä»–é¸æŠï¼ˆJazzy OR ç™ºè¦‹ï¼ OR ãƒ¯ã‚¯ãƒ¯ã‚¯ï¼‰

#### 5.2.5 ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠç”»é¢ï¼ˆGenreSelectionViewï¼‰

**ç›®çš„**: AIãŒææ¡ˆã—ãŸ3ã¤ã®ã‚¸ãƒ£ãƒ³ãƒ«ã‹ã‚‰1ã¤ã‚’é¸æŠ

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ã©ã®ã‚¸ãƒ£ãƒ³ãƒ«ã«ã™ã‚‹ï¼Ÿ   â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     ã‚«ãƒ•ã‚§       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     å…¬åœ’        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    åšç‰©é¤¨       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚                         â”‚
â”‚ â€»ã‚¹ãƒãƒƒãƒˆåã¯åˆ°ç€ã¾ã§ç§˜å¯†ï¼â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ³¨æ„**:
- ã‚¹ãƒãƒƒãƒˆåã¯è¡¨ç¤ºã—ãªã„
- ã‚¸ãƒ£ãƒ³ãƒ«åã®ã¿è¡¨ç¤º
- 3ã¤ã®é¸æŠè‚¢ã‚’æç¤º

#### 5.2.6 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢ï¼ˆNavigationViewï¼‰

**ç›®çš„**: Google Mapsã‚¢ãƒ—ãƒªã§ã®çµŒè·¯æ¡ˆå†…ã¨åˆ°ç€æ¤œçŸ¥

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    çµŒè·¯æ¡ˆå†…é–‹å§‹ï¼        â”‚
â”‚                         â”‚
â”‚  Google Mapsã‚¢ãƒ—ãƒªã§     â”‚
â”‚  ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒé–‹å§‹     â”‚
â”‚  ã•ã‚Œã¾ã™               â”‚
â”‚                         â”‚
â”‚  é¸æŠã‚¸ãƒ£ãƒ³ãƒ«: ã‚«ãƒ•ã‚§      â”‚
â”‚                         â”‚
â”‚  ğŸ¯ åˆ°ç€ã‚’ãŠå¾…ã¡ãã ã•ã„   â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Google Mapsèµ·å‹•  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.2.7 åˆ°ç€ç”»é¢ï¼ˆArrivalViewï¼‰

**ç›®çš„**: çµŒç”±åœ°åˆ°ç€æ™‚ã«ã‚¹ãƒãƒƒãƒˆåã‚’è§£ç¦

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ‰ åˆ°ç€ï¼          â”‚
â”‚                         â”‚
â”‚    ä»Šå›ã®å¯„ã‚Šé“å…ˆã¯      â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 â”‚    â”‚
â”‚  â”‚  ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹   â”‚    â”‚
â”‚  â”‚   æ¸‹è°·åº—        â”‚    â”‚
â”‚  â”‚                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚
â”‚   ç´ æ•µãªå¯„ã‚Šé“ã‚’ï¼       â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    å®Œäº†         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. APIè¨­è¨ˆ

### 6.1 OpenAI APIé€£æº

#### 6.1.1 ãƒªã‚¯ã‚¨ã‚¹ãƒˆä»•æ§˜

```swift
struct OpenAIRequest {
    let model: String = "gpt-4"
    let messages: [ChatMessage]
    let maxTokens: Int = 1000
    let temperature: Double = 0.7
}

struct ChatMessage {
    let role: String // "system", "user"
    let content: String
}

// ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹
let systemPrompt = """
ã‚ãªãŸã¯çµŒç”±åœ°æ¨è–¦ã®å°‚é–€å®¶ã§ã™ã€‚
ä»¥ä¸‹ã®æ¡ä»¶ã«åŸºã¥ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç§»å‹•çµŒè·¯ä¸Šã«ã‚ã‚‹èˆˆå‘³æ·±ã„ã‚¹ãƒãƒƒãƒˆã‚’3ã¤æ¨è–¦ã—ã¦ãã ã•ã„ã€‚

åˆ¶ç´„:
1. é£²é£Ÿåº—ã‚’30%ã€ãã‚Œä»¥å¤–ã‚’70%ã®å‰²åˆã§å«ã‚ã‚‹
2. ç¾åœ¨åœ°ã¨ç›®çš„åœ°ã®é–“ã«ã‚ã‚‹å®Ÿåœ¨ã™ã‚‹ã‚¹ãƒãƒƒãƒˆã®ã¿
3. é™¤å¤–ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‚¹ãƒãƒƒãƒˆã¯é¿ã‘ã‚‹
4. æ°—åˆ†ã¨ç§»å‹•æ‰‹æ®µã‚’è€ƒæ…®ã™ã‚‹
5. GooglePlaces APIã§æ¤œç´¢å¯èƒ½ãªå…·ä½“çš„ãªåç§°ã§å›ç­”ã™ã‚‹

å›ç­”å½¢å¼:
[
  {
    "name": "å…·ä½“çš„ãªã‚¹ãƒãƒƒãƒˆå",
    "category": "restaurant" or "other",
    "reason": "æ¨è–¦ç†ç”±"
  }
]
"""
```

#### 6.1.2 ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†

```swift
struct OpenAIResponse: Codable {
    let choices: [Choice]
    
    struct Choice: Codable {
        let message: ChatMessage
        let finishReason: String?
        
        private enum CodingKeys: String, CodingKey {
            case message
            case finishReason = "finish_reason"
        }
    }
}

struct RecommendationResult: Codable {
    let name: String
    let category: String
    let reason: String
}
```

### 6.2 Google Places APIé€£æº

#### 6.2.1 Places Search API

```swift
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆURLä¾‹
// https://maps.googleapis.com/maps/api/place/textsearch/json?query={ã‚¹ãƒãƒƒãƒˆå}&location={ç·¯åº¦},{çµŒåº¦}&radius={åŠå¾„}&key={APIã‚­ãƒ¼}

struct GooglePlacesSearchRequest {
    let query: String
    let location: CLLocationCoordinate2D
    let radius: Int = 5000 // 5km
    let type: String?
    let apiKey: String
    
    var url: URL? {
        var components = URLComponents(string: "https://maps.googleapis.com/maps/api/place/textsearch/json")
        components?.queryItems = [
            URLQueryItem(name: "query", value: query),
            URLQueryItem(name: "location", value: "\(location.latitude),\(location.longitude)"),
            URLQueryItem(name: "radius", value: "\(radius)"),
            URLQueryItem(name: "key", value: apiKey)
        ]
        
        if let type = type {
            components?.queryItems?.append(URLQueryItem(name: "type", value: type))
        }
        
        return components?.url
    }
}
```

#### 6.2.2 Place Details API

```swift
struct GooglePlaceDetailsRequest {
    let placeId: String
    let fields: [String] = [
        "name", "formatted_address", "geometry", "types",
        "rating", "price_level", "photos", "opening_hours"
    ]
    let apiKey: String
    
    var url: URL? {
        var components = URLComponents(string: "https://maps.googleapis.com/maps/api/place/details/json")
        components?.queryItems = [
            URLQueryItem(name: "place_id", value: placeId),
            URLQueryItem(name: "fields", value: fields.joined(separator: ",")),
            URLQueryItem(name: "key", value: apiKey)
        ]
        return components?.url
    }
}
```

### 6.3 Google Directions APIé€£æº

```swift
struct GoogleDirectionsRequest {
    let origin: CLLocationCoordinate2D
    let destination: CLLocationCoordinate2D
    let waypoints: [CLLocationCoordinate2D]
    let mode: TransportMode
    let apiKey: String
    
    var url: URL? {
        var components = URLComponents(string: "https://maps.googleapis.com/maps/api/directions/json")
        let waypointsString = waypoints.map { "\($0.latitude),\($0.longitude)" }.joined(separator: "|")
        
        components?.queryItems = [
            URLQueryItem(name: "origin", value: "\(origin.latitude),\(origin.longitude)"),
            URLQueryItem(name: "destination", value: "\(destination.latitude),\(destination.longitude)"),
            URLQueryItem(name: "waypoints", value: waypointsString),
            URLQueryItem(name: "mode", value: mode.rawValue),
            URLQueryItem(name: "key", value: apiKey)
        ]
        return components?.url
    }
}
```

---

## 7. ãƒ†ã‚¹ãƒˆè¨­è¨ˆï¼ˆTDDï¼‰

### 7.1 ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

#### 7.1.1 ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    UI Tests â”‚ â† å°‘æ•°
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Integration Testsâ”‚ â† ä¸­ç¨‹åº¦
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    Unit Tests       â”‚ â† å¤šæ•°
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 7.1.2 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

- Unit Tests: 90%ä»¥ä¸Š
- Integration Tests: 70%ä»¥ä¸Š
- UI Tests: ä¸»è¦ãƒ•ãƒ­ãƒ¼100%

### 7.2 Unit Tests

#### 7.2.1 MoodSelectionUseCaseTests

```swift
class MoodSelectionUseCaseTests: XCTestCase {
    var useCase: MoodSelectionUseCase!
    
    override func setUp() {
        super.setUp()
        useCase = MoodSelectionUseCaseImpl()
    }
    
    func test_æ°—åˆ†é¸æŠ_ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã®æ’ä»–åˆ¶å¾¡() {
        // Given
        let mood = Mood(activityType: .indoor, vibeType: .jazzy)
        
        // When
        let result = useCase.validateMoodSelection(mood)
        
        // Then
        XCTAssertTrue(result.isValid)
        XCTAssertEqual(result.mood.activityType, .indoor)
        XCTAssertEqual(result.mood.vibeType, .jazzy)
    }
    
    func test_æ°—åˆ†é¸æŠ_ç„¡åŠ¹ãªçµ„ã¿åˆã‚ã›ã®æ¤œè¨¼() {
        // Given
        let invalidMood = Mood(activityType: .indoor, vibeType: .outdoor) // ç„¡åŠ¹ãªçµ„ã¿åˆã‚ã›
        
        // When
        let result = useCase.validateMoodSelection(invalidMood)
        
        // Then
        XCTAssertFalse(result.isValid)
        XCTAssertNotNil(result.error)
    }
}
```

#### 7.2.2 PlaceRecommendationUseCaseTests

```swift
class PlaceRecommendationUseCaseTests: XCTestCase {
    var useCase: PlaceRecommendationUseCase!
    var mockAIRepository: MockAIRecommendationRepository!
    var mockPlaceRepository: MockPlaceRepository!
    var mockCacheRepository: MockCacheRepository!
    
    override func setUp() {
        super.setUp()
        mockAIRepository = MockAIRecommendationRepository()
        mockPlaceRepository = MockPlaceRepository()
        mockCacheRepository = MockCacheRepository()
        
        useCase = PlaceRecommendationUseCaseImpl(
            aiRepository: mockAIRepository,
            placeRepository: mockPlaceRepository,
            cacheRepository: mockCacheRepository
        )
    }
    
    func test_æ¨è–¦å–å¾—_æ­£å¸¸ã‚±ãƒ¼ã‚¹() async throws {
        // Given
        let currentLocation = CLLocationCoordinate2D(latitude: 35.6812, longitude: 139.7671)
        let destination = CLLocationCoordinate2D(latitude: 35.6895, longitude: 139.6917)
        let mood = Mood(activityType: .outdoor, vibeType: .exciting)
        let transportMode = TransportMode.walking
        
        mockAIRepository.recommendationsToReturn = [
            "ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹æ¸‹è°·åº—",
            "ä»£ã€…æœ¨å…¬åœ’",
            "æ˜æ²»ç¥å®®"
        ]
        
        mockPlaceRepository.placesToReturn = [
            Place(id: "1", name: "ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹æ¸‹è°·åº—", genre: Genre(category: .restaurant)),
            Place(id: "2", name: "ä»£ã€…æœ¨å…¬åœ’", genre: Genre(category: .other)),
            Place(id: "3", name: "æ˜æ²»ç¥å®®", genre: Genre(category: .other))
        ]
        
        // When
        let genres = try await useCase.getRecommendations(
            currentLocation: currentLocation,
            destination: destination,
            mood: mood,
            transportMode: transportMode
        )
        
        // Then
        XCTAssertEqual(genres.count, 3)
        XCTAssertEqual(genres.filter { $0.category == .restaurant }.count, 1) // 30%
        XCTAssertEqual(genres.filter { $0.category == .other }.count, 2) // 70%
    }
    
    func test_æ¨è–¦å–å¾—_å€™è£œãªã—ã‚±ãƒ¼ã‚¹() async {
        // Given
        mockAIRepository.recommendationsToReturn = []
        mockPlaceRepository.placesToReturn = []
        
        // When & Then
        do {
            let _ = try await useCase.getRecommendations(
                currentLocation: CLLocationCoordinate2D(latitude: 0, longitude: 0),
                destination: CLLocationCoordinate2D(latitude: 0, longitude: 0),
                mood: Mood(activityType: .indoor, vibeType: .jazzy),
                transportMode: .walking
            )
            XCTFail("ä¾‹å¤–ãŒç™ºç”Ÿã™ã¹ã")
        } catch {
            XCTAssertTrue(error is PlaceRecommendationError)
            XCTAssertEqual(error as? PlaceRecommendationError, .noValidPlaces)
        }
    }
}
```

### 7.3 Integration Tests

#### 7.3.1 APIé€£æºãƒ†ã‚¹ãƒˆ

```swift
class APIIntegrationTests: XCTestCase {
    var apiClient: OpenAIAPIClient!
    
    override func setUp() {
        super.setUp()
        apiClient = OpenAIAPIClient(apiKey: "test_api_key")
    }
    
    func test_OpenAI_APIå‘¼ã³å‡ºã—() async throws {
        // Given
        let request = OpenAIRecommendationRequest(
            currentLocation: CLLocationCoordinate2D(latitude: 35.6812, longitude: 139.7671),
            destination: CLLocationCoordinate2D(latitude: 35.6895, longitude: 139.6917),
            currentTime: Date(),
            mood: Mood(activityType: .outdoor, vibeType: .exciting),
            transportMode: .walking,
            excludedPlaceIds: []
        )
        
        // When
        let response = try await apiClient.getRecommendations(request: request)
        
        // Then
        XCTAssertFalse(response.isEmpty)
        XCTAssertLessThanOrEqual(response.count, 3)
    }
}
```

### 7.4 UI Tests

#### 7.4.1 ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

```swift
class MainFlowUITests: XCTestCase {
    var app: XCUIApplication!
    
    override func setUp() {
        super.setUp()
        app = XCUIApplication()
        app.launch()
    }
    
    func test_ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼_ç›®çš„åœ°è¨­å®šã‹ã‚‰åˆ°ç€ã¾ã§() {
        // ãƒ›ãƒ¼ãƒ ç”»é¢
        let destinationButton = app.buttons["ç›®çš„åœ°ã‚’è¨­å®šã™ã‚‹"]
        XCTAssertTrue(destinationButton.exists)
        destinationButton.tap()
        
        // ç›®çš„åœ°è¨­å®šç”»é¢
        let searchField = app.textFields["ç›®çš„åœ°ã‚’æ¤œç´¢"]
        searchField.tap()
        searchField.typeText("æ¸‹è°·é§…")
        
        let nextButton = app.buttons["æ¬¡ã¸"]
        nextButton.tap()
        
        // ç§»å‹•æ‰‹æ®µé¸æŠç”»é¢
        let walkingButton = app.buttons["å¾’æ­©"]
        walkingButton.tap()
        nextButton.tap()
        
        // æ°—åˆ†é¸æŠç”»é¢
        let outdoorButton = app.buttons["ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢"]
        let excitingButton = app.buttons["ãƒ¯ã‚¯ãƒ¯ã‚¯"]
        outdoorButton.tap()
        excitingButton.tap()
        nextButton.tap()
        
        // ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠç”»é¢ï¼ˆãƒ¢ãƒƒã‚¯å¿œç­”æƒ³å®šï¼‰
        let genreButton = app.buttons.element(boundBy: 0) // æœ€åˆã®ã‚¸ãƒ£ãƒ³ãƒ«
        XCTAssertTrue(genreButton.exists)
        genreButton.tap()
        
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”»é¢
        let googleMapsButton = app.buttons["Google Mapsèµ·å‹•"]
        XCTAssertTrue(googleMapsButton.exists)
    }
    
    func test_æ°—åˆ†é¸æŠ_æ’ä»–åˆ¶å¾¡() {
        // æ°—åˆ†é¸æŠç”»é¢ã¾ã§é·ç§»
        navigateToMoodSelection()
        
        // ã‚¤ãƒ³ãƒ‰ã‚¢ã‚’é¸æŠ
        let indoorButton = app.buttons["ã‚¤ãƒ³ãƒ‰ã‚¢"]
        indoorButton.tap()
        XCTAssertTrue(indoorButton.isSelected)
        
        // ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ã‚’é¸æŠï¼ˆã‚¤ãƒ³ãƒ‰ã‚¢ã¯è‡ªå‹•ã§éé¸æŠã«ãªã‚‹ï¼‰
        let outdoorButton = app.buttons["ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢"]
        outdoorButton.tap()
        XCTAssertTrue(outdoorButton.isSelected)
        XCTAssertFalse(indoorButton.isSelected)
        
        // ãƒã‚¤ãƒ–ã‚¿ã‚¤ãƒ—ã®æ’ä»–åˆ¶å¾¡
        let jazzyButton = app.buttons["Jazzy"]
        let discoveryButton = app.buttons["ç™ºè¦‹ï¼"]
        
        jazzyButton.tap()
        XCTAssertTrue(jazzyButton.isSelected)
        
        discoveryButton.tap()
        XCTAssertTrue(discoveryButton.isSelected)
        XCTAssertFalse(jazzyButton.isSelected)
    }
}
```

---

## 8. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 8.1 APIã‚­ãƒ¼ç®¡ç†

#### 8.1.1 ç’°å¢ƒå¤‰æ•°ç®¡ç†

```swift
// Config/Environment.swift
enum Environment {
    enum Keys {
        static let openAIAPIKey = "OPENAI_API_KEY"
        static let googleMapsAPIKey = "GOOGLE_MAPS_API_KEY"
        static let googlePlacesAPIKey = "GOOGLE_PLACES_API_KEY"
    }
    
    static func value(for key: String) -> String {
        guard let value = Bundle.main.infoDictionary?[key] as? String else {
            fatalError("ç’°å¢ƒå¤‰æ•° \(key) ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
        }
        return value
    }
}

// ä½¿ç”¨ä¾‹
let openAIAPIKey = Environment.value(for: Environment.Keys.openAIAPIKey)
```

#### 8.1.2 Info.plistè¨­å®š

```xml
<!-- Info.plist -->
<dict>
    <key>OPENAI_API_KEY</key>
    <string>$(OPENAI_API_KEY)</string>
    <key>GOOGLE_MAPS_API_KEY</key>
    <string>$(GOOGLE_MAPS_API_KEY)</string>
    <key>GOOGLE_PLACES_API_KEY</key>
    <string>$(GOOGLE_PLACES_API_KEY)</string>
</dict>
```

### 8.2 ä½ç½®æƒ…å ±ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼

#### 8.2.1 ä½ç½®æƒ…å ±ã®åˆ©ç”¨è¨±å¯

```xml
<!-- Info.plist -->
<key>NSLocationWhenInUseUsageDescription</key>
<string>ç¾åœ¨åœ°ã‹ã‚‰ç›®çš„åœ°ã¸ã®æœ€é©ãªçµŒç”±åœ°ã‚’ææ¡ˆã™ã‚‹ãŸã‚ã«ä½ç½®æƒ…å ±ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</string>
<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>çµŒç”±åœ°ã¸ã®åˆ°ç€ã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã«ä½ç½®æƒ…å ±ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</string>
```

#### 8.2.2 ä½ç½®æƒ…å ±ã®å–ã‚Šæ‰±ã„

```swift
class LocationManager: NSObject, ObservableObject {
    private let manager = CLLocationManager()
    
    override init() {
        super.init()
        manager.delegate = self
        manager.desiredAccuracy = kCLLocationAccuracyBest
    }
    
    func requestPermission() {
        switch manager.authorizationStatus {
        case .notDetermined:
            manager.requestWhenInUseAuthorization()
        case .denied, .restricted:
            // è¨­å®šç”»é¢ã¸ã®èª˜å°
            showLocationPermissionAlert()
        default:
            break
        }
    }
    
    private func showLocationPermissionAlert() {
        // ä½ç½®æƒ…å ±è¨±å¯ã‚’ä¿ƒã™ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
    }
}
```

### 8.3 ãƒ‡ãƒ¼ã‚¿ã®ä¿è­·

#### 8.3.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–

```swift
class SecureCacheRepository: CacheRepository {
    private let keychain = Keychain(service: "com.app.dontgohomestraight")
    
    func saveExcludedPlaceIds(_ placeIds: [String]) async {
        let data = try? JSONEncoder().encode(placeIds)
        let encryptedData = encrypt(data: data)
        keychain["excluded_places"] = encryptedData
    }
    
    func getExcludedPlaceIds() async -> [String] {
        guard let encryptedData = keychain["excluded_places"],
              let data = decrypt(data: encryptedData),
              let placeIds = try? JSONDecoder().decode([String].self, from: data) else {
            return []
        }
        return placeIds
    }
    
    private func encrypt(data: Data?) -> String {
        // AESæš—å·åŒ–å®Ÿè£…
    }
    
    private func decrypt(data: String) -> Data? {
        // AESå¾©å·åŒ–å®Ÿè£…
    }
}
```

---

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ

### 9.1 ã‚¨ãƒ©ãƒ¼å®šç¾©

```swift
enum AppError: LocalizedError {
    case networkError(NetworkError)
    case locationError(LocationError)
    case placeRecommendationError(PlaceRecommendationError)
    case navigationError(NavigationError)
    case validationError(ValidationError)
    
    var errorDescription: String? {
        switch self {
        case .networkError(let error):
            return error.localizedDescription
        case .locationError(let error):
            return error.localizedDescription
        case .placeRecommendationError(let error):
            return error.localizedDescription
        case .navigationError(let error):
            return error.localizedDescription
        case .validationError(let error):
            return error.localizedDescription
        }
    }
}

enum NetworkError: LocalizedError {
    case noInternet
    case timeout
    case invalidResponse
    case apiKeyInvalid
    case rateLimitExceeded
    
    var errorDescription: String? {
        switch self {
        case .noInternet:
            return "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„"
        case .timeout:
            return "é€šä¿¡ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ"
        case .invalidResponse:
            return "ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ãŒç„¡åŠ¹ã§ã™"
        case .apiKeyInvalid:
            return "APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™"
        case .rateLimitExceeded:
            return "APIåˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„"
        }
    }
}

enum PlaceRecommendationError: LocalizedError {
    case noValidPlaces
    case aiServiceUnavailable
    case placesAPIError
    
    var errorDescription: String? {
        switch self {
        case .noValidPlaces:
            return "å€™è£œåœ°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šæ—¥ã¯ã¾ã£ã™ãå¸°ã‚Šã¾ã—ã‚‡ã†ğŸµ"
        case .aiServiceUnavailable:
            return "AIæ¨è–¦ã‚µãƒ¼ãƒ“ã‚¹ãŒä¸€æ™‚çš„ã«åˆ©ç”¨ã§ãã¾ã›ã‚“"
        case .placesAPIError:
            return "å ´æ‰€æ¤œç´¢ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
        }
    }
}
```

### 9.2 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

#### 9.2.1 ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½

```swift
class NetworkManager {
    func request<T: Codable>(_ request: URLRequest, type: T.Type) async throws -> T {
        let maxRetries = 3
        var lastError: Error?
        
        for attempt in 1...maxRetries {
            do {
                let (data, response) = try await URLSession.shared.data(for: request)
                
                guard let httpResponse = response as? HTTPURLResponse else {
                    throw NetworkError.invalidResponse
                }
                
                switch httpResponse.statusCode {
                case 200...299:
                    return try JSONDecoder().decode(T.self, from: data)
                case 429:
                    // Rate limit exceeded - exponential backoff
                    let delay = pow(2.0, Double(attempt))
                    try await Task.sleep(nanoseconds: UInt64(delay * 1_000_000_000))
                    continue
                case 401:
                    throw NetworkError.apiKeyInvalid
                default:
                    throw NetworkError.invalidResponse
                }
            } catch {
                lastError = error
                if attempt == maxRetries {
                    break
                }
                
                // Exponential backoff for retries
                let delay = pow(2.0, Double(attempt))
                try await Task.sleep(nanoseconds: UInt64(delay * 1_000_000_000))
            }
        }
        
        throw lastError ?? NetworkError.invalidResponse
    }
}
```

#### 9.2.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º

```swift
struct ErrorView: View {
    let error: AppError
    let retryAction: (() -> Void)?
    
    var body: some View {
        VStack(spacing: 20) {
            Image(systemName: errorIcon)
                .font(.system(size: 64))
                .foregroundColor(.red)
            
            Text(error.localizedDescription)
                .font(.headline)
                .multilineTextAlignment(.center)
            
            if let retryAction = retryAction {
                Button("å†è©¦è¡Œ") {
                    retryAction()
                }
                .buttonStyle(.borderedProminent)
            }
        }
        .padding()
    }
    
    private var errorIcon: String {
        switch error {
        case .networkError:
            return "wifi.exclamationmark"
        case .locationError:
            return "location.slash"
        case .placeRecommendationError:
            return "questionmark.circle"
        case .navigationError:
            return "map.circle"
        case .validationError:
            return "exclamationmark.triangle"
        }
    }
}
```

---

## 10. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### 10.1 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

#### 10.1.1 ãƒãƒ«ãƒãƒ¬ãƒ™ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥

```swift
protocol CacheRepository {
    func savePlace(_ place: Place, for genre: Genre) async
    func getPlace(for genre: Genre) async -> Place?
    func saveExcludedPlaceIds(_ placeIds: [String]) async
    func getExcludedPlaceIds() async -> [String]
    func clearCache() async
}

class CacheRepositoryImpl: CacheRepository {
    private let memoryCache = NSCache<NSString, NSData>()
    private let diskCache: DiskCache
    private let keychain: Keychain
    
    init() {
        diskCache = DiskCache()
        keychain = Keychain(service: "com.app.dontgohomestraight")
        
        // ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è¨­å®š
        memoryCache.countLimit = 100
        memoryCache.totalCostLimit = 10 * 1024 * 1024 // 10MB
    }
    
    func savePlace(_ place: Place, for genre: Genre) async {
        let key = "place_\(genre.id)"
        let data = try? JSONEncoder().encode(place)
        
        // ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
        if let data = data {
            memoryCache.setObject(data as NSData, forKey: key as NSString)
        }
        
        // ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥
        await diskCache.save(data, for: key)
    }
    
    func getPlace(for genre: Genre) async -> Place? {
        let key = "place_\(genre.id)"
        
        // ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
        if let data = memoryCache.object(forKey: key as NSString) {
            return try? JSONDecoder().decode(Place.self, from: data as Data)
        }
        
        // ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
        if let data = await diskCache.load(for: key) {
            let place = try? JSONDecoder().decode(Place.self, from: data)
            
            // ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
            if let place = place {
                memoryCache.setObject(data as NSData, forKey: key as NSString)
            }
            
            return place
        }
        
        return nil
    }
}
```

#### 10.1.2 ç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥

```swift
class ImageCacheManager: ObservableObject {
    static let shared = ImageCacheManager()
    private let cache = NSCache<NSString, UIImage>()
    private let fileManager = FileManager.default
    
    init() {
        cache.countLimit = 100
        cache.totalCostLimit = 50 * 1024 * 1024 // 50MB
    }
    
    func image(for url: URL) async -> UIImage? {
        let key = url.absoluteString as NSString
        
        // ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
        if let cachedImage = cache.object(forKey: key) {
            return cachedImage
        }
        
        // ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
        if let cachedImage = loadImageFromDisk(for: url) {
            cache.setObject(cachedImage, forKey: key)
            return cachedImage
        }
        
        // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å–å¾—
        do {
            let (data, _) = try await URLSession.shared.data(from: url)
            guard let image = UIImage(data: data) else { return nil }
            
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
            cache.setObject(image, forKey: key)
            saveImageToDisk(image, for: url)
            
            return image
        } catch {
            return nil
        }
    }
    
    private func loadImageFromDisk(for url: URL) -> UIImage? {
        let filename = url.lastPathComponent
        let filePath = getCacheDirectory().appendingPathComponent(filename)
        return UIImage(contentsOfFile: filePath.path)
    }
    
    private func saveImageToDisk(_ image: UIImage, for url: URL) {
        guard let data = image.jpegData(compressionQuality: 0.8) else { return }
        let filename = url.lastPathComponent
        let filePath = getCacheDirectory().appendingPathComponent(filename)
        try? data.write(to: filePath)
    }
    
    private func getCacheDirectory() -> URL {
        return fileManager.urls(for: .cachesDirectory, in: .userDomainMask)[0]
    }
}
```

### 10.2 éåŒæœŸå‡¦ç†ã®æœ€é©åŒ–

#### 10.2.1 ä¸¦åˆ—å‡¦ç†ã«ã‚ˆã‚‹é«˜é€ŸåŒ–

```swift
class PlaceRecommendationService {
    func getRecommendations(request: RecommendationRequest) async throws -> [Genre] {
        // ä¸¦åˆ—ã§APIå‘¼ã³å‡ºã—å®Ÿè¡Œ
        async let aiRecommendations = aiRepository.getRecommendations(request: request)
        async let nearbyPlaces = placeRepository.getNearbyPlaces(
            location: request.currentLocation,
            radius: 5000
        )
        async let excludedPlaces = cacheRepository.getExcludedPlaceIds()
        
        // çµæœã‚’å¾…æ©Ÿ
        let (recommendations, nearby, excluded) = try await (
            aiRecommendations,
            nearbyPlaces,
            excludedPlaces
        )
        
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨æ¤œè¨¼ã‚’ä¸¦åˆ—å®Ÿè¡Œ
        let validationTasks = recommendations.map { recommendation in
            Task {
                return await validatePlace(recommendation: recommendation, nearbyPlaces: nearby)
            }
        }
        
        var validPlaces: [Place] = []
        for task in validationTasks {
            if let place = await task.value {
                validPlaces.append(place)
            }
        }
        
        return generateGenres(from: validPlaces)
    }
}
```

#### 10.2.2 ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰æˆ¦ç•¥

```swift
class PreloadManager {
    private let locationManager: LocationManager
    private let placeRepository: PlaceRepository
    
    func startPreloading() {
        Task {
            await preloadNearbyPlaces()
            await preloadCommonGenres()
        }
    }
    
    private func preloadNearbyPlaces() async {
        guard let currentLocation = locationManager.currentLocation else { return }
        
        // ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚«ãƒ†ã‚´ãƒªã®å ´æ‰€ã‚’äº‹å‰ã«å–å¾—
        let commonTypes = ["restaurant", "tourist_attraction", "park", "museum", "cafe"]
        
        await withTaskGroup(of: Void.self) { group in
            for type in commonTypes {
                group.addTask {
                    let _ = try? await self.placeRepository.searchPlaces(
                        location: currentLocation,
                        type: type,
                        radius: 3000
                    )
                }
            }
        }
    }
    
    private func preloadCommonGenres() async {
        // ã‚ˆãé¸ã°ã‚Œã‚‹ã‚¸ãƒ£ãƒ³ãƒ«ã®æƒ…å ±ã‚’äº‹å‰ã«æº–å‚™
        let commonGenres = [
            Genre(name: "ã‚«ãƒ•ã‚§", category: .restaurant),
            Genre(name: "å…¬åœ’", category: .other),
            Genre(name: "ç¾è¡“é¤¨", category: .other)
        ]
        
        for genre in commonGenres {
            await cacheRepository.preloadGenreData(genre)
        }
    }
}
```

---

## 11. é‹ç”¨ãƒ»ç›£è¦–è¨­è¨ˆ

### 11.1 ãƒ­ã‚°è¨­è¨ˆ

#### 11.1.1 ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã¨ã‚«ãƒ†ã‚´ãƒª

```swift
enum LogLevel: String {
    case debug = "DEBUG"
    case info = "INFO"
    case warning = "WARNING"
    case error = "ERROR"
    case critical = "CRITICAL"
}

enum LogCategory: String {
    case ui = "UI"
    case api = "API"
    case location = "LOCATION"
    case navigation = "NAVIGATION"
    case cache = "CACHE"
    case security = "SECURITY"
}

class Logger {
    static let shared = Logger()
    
    func log(_ message: String, level: LogLevel, category: LogCategory, file: String = #file, function: String = #function, line: Int = #line) {
        let timestamp = DateFormatter.logFormatter.string(from: Date())
        let filename = URL(fileURLWithPath: file).lastPathComponent
        
        let logMessage = "[\(timestamp)] [\(level.rawValue)] [\(category.rawValue)] \(filename):\(line) \(function) - \(message)"
        
        #if DEBUG
        print(logMessage)
        #endif
        
        // æœ¬ç•ªç’°å¢ƒã§ã¯é©åˆ‡ãªãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡
        if level == .error || level == .critical {
            sendToRemoteLogging(logMessage)
        }
    }
    
    private func sendToRemoteLogging(_ message: String) {
        // Crashlyticsã€Sentryç­‰ã¸ã®é€ä¿¡
    }
}

// ä½¿ç”¨ä¾‹
extension Logger {
    func logAPICall(_ url: String, statusCode: Int) {
        log("APIå‘¼ã³å‡ºã—: \(url), ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: \(statusCode)", level: .info, category: .api)
    }
    
    func logLocationUpdate(_ location: CLLocation) {
        log("ä½ç½®æƒ…å ±æ›´æ–°: \(location.coordinate)", level: .debug, category: .location)
    }
    
    func logError(_ error: Error, context: String) {
        log("ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: \(error.localizedDescription), ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: \(context)", level: .error, category: .ui)
    }
}
```

### 11.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

#### 11.2.1 ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†

```swift
class PerformanceMonitor {
    static let shared = PerformanceMonitor()
    
    func measureExecutionTime<T>(
        operation: String,
        category: LogCategory,
        execute: () async throws -> T
    ) async rethrows -> T {
        let startTime = CFAbsoluteTimeGetCurrent()
        let result = try await execute()
        let executionTime = CFAbsoluteTimeGetCurrent() - startTime
        
        Logger.shared.log(
            "å®Ÿè¡Œæ™‚é–“: \(operation) - \(String(format: "%.3f", executionTime))ç§’",
            level: .info,
            category: category
        )
        
        // ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡
        sendMetric(operation: operation, duration: executionTime)
        
        return result
    }
    
    private func sendMetric(operation: String, duration: TimeInterval) {
        // Analytics service ã¸ã®é€ä¿¡
        #if !DEBUG
        // Firebase Analytics, Mixpanelç­‰
        #endif
    }
}

// ä½¿ç”¨ä¾‹
let places = await PerformanceMonitor.shared.measureExecutionTime(
    operation: "AIæ¨è–¦å–å¾—",
    category: .api
) {
    try await aiRepository.getRecommendations(request: request)
}
```

### 11.3 ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒãƒ¼ãƒˆ

#### 11.3.1 Crashlyticsé€£æº

```swift
import FirebaseCrashlytics

class CrashReporter {
    static let shared = CrashReporter()
    
    func recordError(_ error: Error, additionalInfo: [String: Any] = [:]) {
        #if !DEBUG
        Crashlytics.crashlytics().record(error: error)
        
        for (key, value) in additionalInfo {
            Crashlytics.crashlytics().setCustomValue(value, forKey: key)
        }
        #endif
    }
    
    func setUserInfo(userId: String?) {
        #if !DEBUG
        Crashlytics.crashlytics().setUserID(userId)
        #endif
    }
    
    func logBreadcrumb(_ message: String) {
        #if !DEBUG
        Crashlytics.crashlytics().log(message)
        #endif
    }
}
```

---

## 12. è¨­å®šãƒ»ç’°å¢ƒç®¡ç†

### 12.1 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

#### 12.1.1 é–‹ç™ºç’°å¢ƒåˆ¥è¨­å®š

```
Config/
â”œâ”€â”€ Development.xcconfig
â”œâ”€â”€ Staging.xcconfig
â”œâ”€â”€ Production.xcconfig
â””â”€â”€ Base.xcconfig
```

```
// Base.xcconfig
APP_NAME = ã¾ã£ã™ãå¸°ã‚ŠãŸããªã„
BUNDLE_ID_PREFIX = com.app.dontgohomestraight

// Development.xcconfig
#include "Base.xcconfig"
APP_NAME = $(APP_NAME) Dev
BUNDLE_IDENTIFIER = $(BUNDLE_ID_PREFIX).dev
API_BASE_URL = https://api-dev.example.com

// Production.xcconfig
#include "Base.xcconfig"
BUNDLE_IDENTIFIER = $(BUNDLE_ID_PREFIX)
API_BASE_URL = https://api.example.com
```

#### 12.1.2 ç’°å¢ƒå¤‰æ•°ç®¡ç†

```swift
enum BuildConfiguration {
    case debug
    case staging
    case release
    
    static var current: BuildConfiguration {
        #if DEBUG
        return .debug
        #elseif STAGING
        return .staging
        #else
        return .release
        #endif
    }
}

struct AppConfiguration {
    static let shared = AppConfiguration()
    
    let apiTimeout: TimeInterval
    let cacheSize: Int
    let logLevel: LogLevel
    let isAnalyticsEnabled: Bool
    
    private init() {
        switch BuildConfiguration.current {
        case .debug:
            apiTimeout = 60.0
            cacheSize = 50 * 1024 * 1024 // 50MB
            logLevel = .debug
            isAnalyticsEnabled = false
            
        case .staging:
            apiTimeout = 30.0
            cacheSize = 100 * 1024 * 1024 // 100MB
            logLevel = .info
            isAnalyticsEnabled = true
            
        case .release:
            apiTimeout = 15.0
            cacheSize = 200 * 1024 * 1024 // 200MB
            logLevel = .warning
            isAnalyticsEnabled = true
        }
    }
}
```

---

## 13. ã¾ã¨ã‚

### 13.1 æŠ€è¡“çš„ãªç‰¹å¾´

1. **Clean Architecture**: ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢ã«ã‚ˆã‚‹ä¿å®ˆæ€§ã®å‘ä¸Š
2. **TDDæ¡ç”¨**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§ã®é–‹ç™ºã«ã‚ˆã‚‹å“è³ªä¿è¨¼
3. **éåŒæœŸå‡¦ç†**: Combine + async/awaitã«ã‚ˆã‚‹ç¾ä»£çš„ãªä¸¦è¡Œå‡¦ç†
4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: APIã‚­ãƒ¼ã®é©åˆ‡ãªç®¡ç†ã¨ä½ç½®æƒ…å ±ã®ä¿è­·
5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒãƒ«ãƒãƒ¬ãƒ™ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ä¸¦åˆ—å‡¦ç†ã«ã‚ˆã‚‹æœ€é©åŒ–

### 13.2 é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

#### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆ2é€±é–“ï¼‰
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­å®š
- Domainå±¤ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè£…
- åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ§‹ç¯‰

#### Phase 2: ã‚³ã‚¢æ©Ÿèƒ½å®Ÿè£…ï¼ˆ3é€±é–“ï¼‰
- APIé€£æºï¼ˆOpenAI, Google Placesï¼‰
- ä½ç½®æƒ…å ±ç®¡ç†ã¨ãƒãƒƒãƒ—çµ±åˆ
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…

#### Phase 3: UIå®Ÿè£…ï¼ˆ2é€±é–“ï¼‰
- SwiftUIã§ã®ç”»é¢å®Ÿè£…
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼å®Œæˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

#### Phase 4: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»æœ€é©åŒ–ï¼ˆ1é€±é–“ï¼‰
- çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»

### 13.3 ãƒªã‚¹ã‚¯ç®¡ç†

#### é«˜ãƒªã‚¹ã‚¯é …ç›®
1. **APIåˆ¶é™**: OpenAI/Google APIã®åˆ©ç”¨åˆ¶é™
2. **ä½ç½®æƒ…å ±ç²¾åº¦**: åˆ°ç€åˆ¤å®šã®ç²¾åº¦å•é¡Œ
3. **å®Ÿåœ¨æ€§æ¤œè¨¼**: AIæ¨è–¦ã‚¹ãƒãƒƒãƒˆã®å®Ÿåœ¨æ€§ç¢ºèª

#### å¯¾ç­–
1. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**: APIå¤±æ•—æ™‚ã®ä»£æ›¿æ©Ÿèƒ½
2. **ç²¾åº¦èª¿æ•´**: åˆ°ç€åˆ¤å®šç¯„å›²ã®å‹•çš„èª¿æ•´
3. **äºŒé‡æ¤œè¨¼**: Places APIã§ã®å®Ÿåœ¨æ€§ç¢ºèªå¼·åŒ–

---

ã“ã®è©³ç´°è¨­è¨ˆæ›¸ã«ã‚ˆã‚Šã€è¦ä»¶å®šç¾©æ›¸ã®å†…å®¹ã‚’å…·ä½“çš„ãªå®Ÿè£…å¯èƒ½ãªå½¢ã«è½ã¨ã—è¾¼ã¿ã¾ã—ãŸã€‚ç‰¹ã«ã€Œã‚¹ãƒãƒƒãƒˆåã®ç§˜åŒ¿ã€ã€Œåˆ°ç€æ™‚ã®é–‹ç¤ºã€ã€ŒAIÃ—GoogleMapé€£æºã€ã€ŒTDDé–‹ç™ºã€ã¨ã„ã£ãŸè¦ä»¶ã‚’æŠ€è¡“çš„ã«å®Ÿç¾ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªè¨­è¨ˆã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚