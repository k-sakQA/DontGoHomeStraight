# iPhoneアプリ要件定義書  
**アプリ名：まっすぐ帰りたくない**

---

## 1. 背景・目的

「たまには寄り道したい」「新しい発見をしたい」ユーザーに、AI×GoogleMap連携でサプライズな寄り道体験を提供する。

---

## 2. 対象ユーザー

- iPhoneユーザー（個人配布・テスト用途が中心）
- 普段と違う移動体験やワクワクを求める人

---

## 3. ユースケース一覧

1. **目的地を設定**  
　ユーザーが地図またはテキスト入力で目的地を指定

2. **移動手段を選択**  
　徒歩・車・公共交通機関等を選ぶ

3. **今の気分を選択**  
　- 「インドア」「アウトドア」：どちらか一方のみ選択可能
　- 「Jazzy」「発見！」「ワクワク」：この3つの中からいずれか1つのみ選択可能
　- 各グループから1つずつ選ぶ形式  
　　（例：アウトドア＋ワクワク、インドア＋Jazzy、など。同グループ内の複数選択は不可）

4. **AIによる経由地提案**  
　- 現在地/目的地/現在時刻/気分をOpenAI APIへ送信
　- Google Places APIで実在スポットのみ取得
　- 経由地候補3件を「ジャンル」と共に提示（飲食店30%、それ以外70%／ジャンルはGoogleMap分類を利用）
　- 候補地がなければ「候補地がありません。今日はまっすぐ帰りましょう🎵」と返す

5. **経由地ジャンル選択**  
　- 3つのジャンルから1つを選択（スポット名は一切表示しない）

6. **経路案内スタート**  
　- 選択したジャンルに紐づいたスポットを経由地とし、GoogleMapアプリ内で経路案内を開始

7. **スポット情報開示**  
　- ユーザーが経由地に到着した際（GoogleMapの「到着」判定後）に、スポット名をアプリ上に表示

---

## 4. 機能要件

- 目的地設定（地図タップ/検索入力）
- 移動手段選択
- 気分ボタン選択（グループごとの排他ロジック）
- ジャンル選択（候補3つ・ジャンル名のみ・スポット名は伏せる）
- スタートボタンで経路案内開始（GoogleMap連携）
- 到着時にスポット名を解禁して表示

---

## 5. バックエンド／AI連携

- OpenAI API連携（気分/現在地/目的地/時刻/除外スポットリストを送信）
- Google Places APIでスポット情報取得＆ジャンル分類
- 飲食店30%、それ以外70%の割合で候補を構成
- 過去提示スポットはキャッシュ管理し、AIに除外リストとして渡す
- スポット名はジャンル選択〜到着までは非表示
- ジャンルはGoogleMapの分類名をそのまま利用

---

## 6. 非機能要件

- 疎結合な設計
- ファイル肥大化の防止（コンポーネント/ロジック分割）
- t-wada流TDDで開発（テストコード必須）
- APIキーは.env管理
- ストア配布はせず、個別インストール運用

---

## 7. 重要な制約・注意点

- ジャンル提示時・経路案内中はスポット名を絶対に表示しない
- 到着判定はGoogleMap経由で取得し、到着時のみスポット名を明かす
- 候補スポットは「実在」するもののみ
- 「候補地なし」の場合は「候補地がありません。今日はまっすぐ帰りましょう🎵」と返す
- アプリ名は「まっすぐ帰りたくない」
